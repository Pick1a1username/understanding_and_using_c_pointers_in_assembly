     1                                  extern malloc
     2                                  
     3                                  struc _node
     4 00000000 ????????????????            _n_data:  resq 1  ; the address of data of the node
     5 00000008 ????????????????            _n_next:  resq 1  ; the address of the next node
     6                                  endstruc
     7                                  
     8                                  struc _linkedList
     9 00000000 ????????????????            _l_head:     resq 1  ; the address of the head node
    10 00000008 ????????????????            _l_tail:     resq 1  ; the address of the tail node
    11 00000010 ????????????????            _l_current:  resq 1  ; the address of the current node
    12                                  endstruc
    13                                  
    14                                  section .text
    15                                  
    16                                  ;
    17                                  ;
    18                                  ; * Args
    19                                  ;   * rdi: the address of a list
    20                                  global initialize_list
    21                                  initialize_list:
    22                                      section .text
    23 00000000 55                              push rbp
    24 00000001 4889E5                          mov  rbp, rsp
    25                                  
    26 00000004 BF00000000                      mov  rdi, 0          ; Set _l_head to NULL
    27 00000009 4883C708                        add  rdi, _l_tail
    28 0000000D BF00000000                      mov  rdi, 0          ; Set _l_tail to NULL
    29 00000012 4883C710                        add  rdi, _l_current
    30 00000016 BF00000000                      mov  rdi, 0          ; Set _l_current to NULL
    31                                  
    32 0000001B C9                              leave
    33 0000001C C3                              ret
    34                                  
    35                                  ;
    36                                  ;
    37                                  ; * Args
    38                                  ;   * rdi: the address of a list
    39                                  ;   * rsi: the address of data
    40                                  global add_head
    41                                  add_head:
    42                                      section .text
    43 0000001D 55                              push rbp
    44 0000001E 4889E5                          mov  rbp, rsp
    45                                  
    46 00000021 4989FC                          mov r12, rdi  ; the address of a list
    47 00000024 4989F5                          mov r13, rsi  ; the address of data
    48                                  
    49                                          ; Allocate memory for new node
    50 00000027 4831FF                          xor  rdi, rdi
    51 0000002A BF00000000                      mov  rdi, _n_data
    52 0000002F 4883C708                        add  rdi, _n_next
    53 00000033 4883C708                        add  rdi, 8
    54 00000037 E8(00000000)                    call malloc
    55 0000003C 4989C6                          mov  r14, rax         ; the address of new node
    56                                  
    57                                          ; Set the data of new node to
    58                                          ; the address of data passed as an argument.
    59 0000003F 4C89E8                          mov  rax, r13
    60                                  
    61                                          ; Check the head of the list
    62 00000042 49F7C400000000                  test r12, 0x0000000000000000
    63 00000049 7518                            jnz .yes_head
    64                                  
    65                                          ; If there is no head in the list, set the head to new node
    66                                          ; and set the next of new node to NULL
    67                                          .no_head:
    68 0000004B 4C89E7                          mov  rdi, r12
    69 0000004E 4883C708                        add  rdi, _l_tail
    70 00000052 4C8937                          mov  [rdi], r14
    71                                  
    72 00000055 4C89F7                          mov  rdi, r14
    73 00000058 4883C708                        add  rdi, _n_next
    74 0000005C BF00000000                      mov  rdi, 0        ; Is this okay?
    75                                  
    76 00000061 EB0A                            jmp .last_step
    77                                  
    78                                          ; If there is a head in the list,
    79                                          ; set the next of new node to the head of the list.
    80                                          .yes_head:
    81 00000063 4C89F7                          mov  rdi, r14
    82 00000066 4883C708                        add  rdi, _n_next
    83 0000006A 4C89E7                          mov  rdi, r12 
    84                                  
    85                                          ; Set the head of the list
    86                                          .last_step:
    87 0000006D 4D893424                        mov [r12], r14
    88                                  
    89 00000071 C9                              leave
    90 00000072 C3                              ret
    91                                  
    92                                  
    93                                  
    94                                  
    95                                  
    96                                  
    97                                  
    98                                  
    99                                   
   100                                  
